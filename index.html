<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ >
	<title>Swing analytics</title>

	<!-- Google fonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
	<!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
	<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

	<script src="http://d3js.org/d3.v3.min.js"></script>
		
	<!-- jQuery -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<!-- Bootstrap 3 -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-paper.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

	<link rel="stylesheet" href="css/style.css">
	
</head>
<body>

	<div class="chartWrapper">
		<div id="cont" class="container-fluid">
	
			<!-- First step - Pulsating Circle -->
			<div class="row text-center stepOneElements">				
				<div class="col-sm-6 column text-center">
					<div class="chartLeft"></div>
				</div>
				
				<div class="col-sm-6 column text-center stepOneText" style="visibility: hidden;">
					<h3 style="color: #575757;">Swing Analytics</h1>
					<hr>
					<img style="padding-top: 70px;" width=500 src="img/Deloitte-logo.png"/>
					<h4 style="color: #999; padding-top: 30px;">#welkegolfprobenjij</h4>
				</div>
			</div>
			
			<!-- Second step - Find Peer group -->
			<div class="row text-center stepTwoElements">	
				<div class="col-sm-12 column text-center">
					<div class="row text-center">
						<h1>Bepaal je Referentiegroep</h1>
						<hr>
						
						<div class="col-sm-12 column text-center">					
							<div class="col-sm-4 column text-center">						
								<h3 style="padding-bottom: 10px; padding-top: 10px;">Geslacht</h3>
								<div id="buttonWrapper" class="btn-group" data-toggle="buttons">
									<label id="maleButton" class="btn btn-default btn-xlarge"><input type="radio" class="btn-options"> Man </label>
									<label id="femaleButton" class="btn btn-default active btn-xlarge"><input type="radio" class="btn-options"> Vrouw </label>
								</div>
							</div>
							<div class="col-sm-4 column text-center">	
								<h3 style="padding-bottom: 10px;">Geboortejaar</h3>
								<div id="buttonWrapper" class="btn-group" data-toggle="buttons">
									<label id="1950_Button" class="btn btn-default btn-xlarge"><input type="radio" class="btn-options"> < 1975 </label>
									<label id="1975_Button" class="btn btn-default active btn-xlarge"><input type="radio" class="btn-options"> 1975 - 1985 </label>
									<label id="1985_Button" class="btn btn-default btn-xlarge"><input type="radio" class="btn-options"> > 1985 </label>
								</div>
							</div>
							<div class="col-sm-4 column text-center">			
								<h3 style="padding-bottom: 10px;">Handicap</h3>
								<div id="buttonWrapper" class="btn-group" data-toggle="buttons">
									<label id="0_Button" class="btn btn-default btn-xlarge"><input type="radio" class="btn-options"> 0 - 5 </label>
									<label id="5_Button" class="btn btn-default active btn-xlarge"><input type="radio" class="btn-options"> 5 - 15 </label>
									<label id="15_Button" class="btn btn-default btn-xlarge"><input type="radio" class="btn-options"> 15 - 25 </label>
									<label id="25_Button" class="btn btn-default btn-xlarge"><input type="radio" class="btn-options"> 25 - 36 </label>
								</div>
							</div>
						</div>
					</div>
					
					<div style="height: 100px;"></div>
					
					<div class="row text-center">
						<span style="font-size: 13px;">Wilt u de resultaten ook graag per e-mail ontvangen of delen via Twitter, vul dan hieronder uw gegevens in</span>
						<div style="height: 20px;"></div>
						<div class="col-sm-3 col-sm-offset-2 column text-center">
							<h5 style="padding-bottom: 10px;">E-mail</h5>
							<form role="form">
								<div class="form-group">
									<input type="text" class="form-control" placeholder="E-mail address" id="emailInput">
								</div>
							</form>
						</div>
						<div class="col-sm-3 col-sm-offset-2 column text-center">
							<h5 style="padding-bottom: 10px;">Twitter</h5>
							<form role="form">
								<div class="form-group">
									<input type="text" class="form-control" placeholder="Username" id="twitterInput">
								</div>
							</form>
						</div>
					</div>
					
					<div style="height: 50px;"></div>
					
					<div class="row text-center">
						<div class="col-sm-12 column text-center">
							<div class="submitButton"></div>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Third step - Hitting charts -->
			<div class="row text-center stepThreeElements">	
				<h1 class="stepThreeTitle">Klaar voor slag 1</h1>
				<hr>
				
				<div class="row text-center">
					<div class="col-sm-6 column text-center">
						<h5 style="padding-bottom: 10px;">Ball Speed [m/h]</h5>
						<div class="chart ballSpeed"></div>
					</div>	
					<div class="col-sm-6 column text-center">
						<h5 style="padding-bottom: 10px;">Club Speed [m/h]</h5>
						<div class="chart clubSpeed"></div>
					</div>
				</div>
				
				<div class="row text-center">
					<div class="col-sm-6 column text-center">
						<div class="chart carry"></div>
					</div>	
					<div class="col-sm-6 column text-center">
						<div class="chart aoa"></div>
					</div>
				</div>
			</div>
			
		</div>
	
	</div>
	
	<!-- Attribution -->
	<div style="width: 100%; bottom: 20px; position: absolute;">
		<div class="attribution">Deloitte  |  Swing Analytics  |  #welkegolfprobenjij</div>
	</div>

	<script>
	
var data = [
    {
        "AttackAngle": "-4.62",
        "BallSpeed": "110.1916644",
        "Carry": "125.90",
        "ClubSpeed": "82.431239",
        "Side": "-2.99",
        "Time": "2015-05-21 13:35:28.534746",
        "UID": "7ed5f514-3abb-43ed-9a25-174cd636f180",
        "id": 1
    },
    {
        "AttackAngle": "-4.94",
        "BallSpeed": "115.0010854",
        "Carry": "137.46",
        "ClubSpeed": "82.878627",
        "Side": "8.95",
        "Time": "2015-05-21 13:35:37.533967",
        "UID": "7ed5f514-3abb-43ed-9a25-174cd636f180",
        "id": 2
    },
    {
        "AttackAngle": "3.05",
        "BallSpeed": "90",
        "Carry": "60.56",
        "ClubSpeed": "93.4",
        "Side": "12.43",
        "Time": "2015-05-21 13:35:40",
        "UID": "7ed5f514-3abb-43ed-9a25-174cd636f180",
        "id": 3
    },
    {
        "AttackAngle": "1.23",
        "BallSpeed": "155.43",
        "Carry": "186.93",
        "ClubSpeed": "45.64",
        "Side": "3.24",
        "Time": "2015-05-21 13:35:42",
        "UID": "7ed5f514-3abb-43ed-9a25-174cd636f180",
        "id": 4
    },
    {
        "AttackAngle": "-2.45",
        "BallSpeed": "40.76",
        "Carry": "250.44",
        "ClubSpeed": "110.34",
        "Side": "34.35",
        "Time": "2015-05-21 13:35:44",
        "UID": "7ed5f514-3abb-43ed-9a25-174cd636f180",
        "id": 5
    }
];

//Brush is the higher focus chart, All is the smaller context chart	
var margin = {top: 30, right: 30, bottom: 30, left: 30},
    width = $(".chartLeft").width() - margin.left - margin.right,
	height = $(window).height() - margin.top - margin.bottom - 80;
	
////////////////////////////////////////////////////////////// 
///////////////// Step 1 - Pulsating dot ///////////////////// 
////////////////////////////////////////////////////////////// 

	
//Create SVG
var svgGreenDot = d3.select(".chartLeft").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
	.attr("class", "greenDotWrapper")
	.on("click", setupPeergroup)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	
d3.select(".stepOneText")
	.style("top", ((height/2 - 200)+"px"))
	.style("visibility", "visible");
	
var circleSize = 50;

//Create the two circles that will pulse
svgGreenDot.selectAll(".pulseCircle")
			.data([0,1]).enter()
			.append("circle")
			.attr("class", "pulseCircle")
			.attr("r", circleSize)
			.attr("cx", width / 2)
			.attr("cy", height / 2)
			.style("fill", "#81BC00")
			.each(pulse);

function pulse() {
	var circle = svgGreenDot.selectAll(".pulseCircle");
	(function repeat() {
		circle.transition()
			.duration(1500).delay(function(d,i) {return i*500;})
			.attr("r", circleSize*0.8)
			.style("opacity", 0.9)
		
		circle.transition().duration(1500).delay(function(d,i) {return 1500; })
			.attr("r", circleSize*1.75)
			.style("opacity", 0.2)
			.each("end", repeat);
	})();
}//pulse

//One steady circle in the center
var circleCenter = svgGreenDot.append("circle")
					.attr("class", "steadyCircle")
					.attr("cx", width/2)
					.attr("cy", height/2)
					.attr("r", circleSize)
					.style("fill", "#81BC00");

////////////////////////////////////////////////////////////// 
////////////// Step 2 - Select peer group //////////////////// 
////////////////////////////////////////////////////////////// 
					
function setupPeergroup() {

	//Increase size, decrease opacity then remove
	d3.selectAll(".steadyCircle")
		.transition().duration(750)
		.attr("r", 400)
		.style("opacity", 0)
		.remove();
		
	d3.selectAll(".pulseCircle")
		.transition().duration(750)
		.attr("r", 0)
		.style("opacity", 0)
		.remove();
		
	d3.selectAll(".stepOneText").style("display", "none");
	
	setTimeout(function() {
		d3.selectAll(".stepOneElements").style("display", "none");
		d3.select(".greenDotWrapper").remove();
		d3.selectAll(".stepTwoElements").style("display", "block");
		d3.selectAll(".btn.stepTwoElements").style("display", "inline-block");
	}, 1000);
	

	var widthCircle = 80,
		heightCircle = widthCircle;
	//Create SVG
	var svgGreenSubmitDot = d3.select(".submitButton").append("svg")
		.attr("width", widthCircle)
		.attr("height", heightCircle)
		.attr("class", "greenSubmitDot")
		//.on("click", setupCharts)
	  .append("g")
		.attr("transform", "translate(" + widthCircle/2 + "," + heightCircle/2 + ")");
		
	//Filter for the outside glow
	var filter = svgGreenSubmitDot.append('defs').append('filter').attr('id','glow'),
		feGaussianBlur = filter.append('feGaussianBlur').attr('stdDeviation','3.5').attr('result','coloredBlur'),
		feMerge = filter.append('feMerge'),
		feMergeNode_1 = feMerge.append('feMergeNode').attr('in','coloredBlur'),
		feMergeNode_2 = feMerge.append('feMergeNode').attr('in','SourceGraphic');
		
	svgGreenSubmitDot.append("circle")
			.attr("class", "submitCircle")
			.attr("cx", 0)
			.attr("cy", 0)
			.attr("r", (widthCircle/2*0.8))
			.style("filter" , "url(#glow)")
			.style("fill", "#81BC00")
			.style("cursor","pointer")
			.on("click", moveTwoToThree);
			
	svgGreenSubmitDot.append("text")
			.attr("class", "submitText")
			.style("text-anchor", "middle")
			.style("fill", "white")
			.style("font-size", 13)
			.style("font-weight", 400)
			.attr("dy", "0.35em")
			.style("pointer-events", "none")
			.text("submit");
		
//Handicap: 0 - 54
}//setupPeergroup

////////////////////////////////////////////////////////////// 
//////////////// Step 3 - Actual Visuals ///////////////////// 
////////////////////////////////////////////////////////////// 

function moveTwoToThree() {

	//Decrease size, decrease opacity then remove
	d3.selectAll(".submitCircle")
		.transition().duration(500)
		.attr("r", 0)
		.style("opacity", 0)
		.remove();
	
	//Hide previous section and display the swing visuals
	setTimeout(function(d) {
		d3.selectAll(".stepTwoElements").style("display", "none");
		d3.select(".greenSubmitDot").remove();
		d3.selectAll(".stepThreeElements").style("display", "block");
		setupVisuals();		
	}, 500);

}//moveTwoToThree	



var numSwings = 0; //The swing number we are at	

var	marginBallSpeed,
	widthBallSpeed,
	heightBallSpeed,
	ballSpeedScale,
	ballSpeedAxis,
	ballSpeed;
	
var	marginClubSpeed,
	widthClubSpeed,
	heightClubSpeed,
	clubSpeedScale,
	clubSpeedAxis,
	clubSpeed;
	
var clubSpeedCircles;

function setupVisuals() {

	//Decrease size, decrease opacity then remove
	d3.selectAll(".submitCircle")
		.transition().duration(500)
		.attr("r", 0)
		.style("opacity", 0)
		.remove();
	
	//Hide previous section and display the swing visuals
	setTimeout(function(d) {
		d3.selectAll(".stepTwoElements").style("display", "none");
		d3.select(".greenSubmitDot").remove();
		d3.selectAll(".stepThreeElements").style("display", "block");
	}, 500);

	//Dummy method to simulate swings 
	d3.select("body").on("click", function(d) {
		numSwings++; 
		d3.select(".stepThreeTitle").text("Klaar voor slag " + (numSwings+1));
		redrawSwing(numSwings);  
	})
		
	////////////////////////////////////////////////////////////// 
	////////////////////// Ball Speed //////////////////////////// 
	////////////////////////////////////////////////////////////// 

	marginBallSpeed = {top: 30, right: 50, bottom: 30, left: 50};
	widthBallSpeed = $(".chart.ballSpeed").width() - marginBallSpeed.left - marginBallSpeed.right;
	heightBallSpeed = widthBallSpeed*0.5;
		
	//Create axes for the Ball Speed chart
	ballSpeedScale = d3.scale.linear().domain([0, 185]).range([0, widthBallSpeed]);
	ballSpeedAxis = d3.svg.axis().scale(ballSpeedScale).orient("bottom").tickSize(20).outerTickSize(0).tickFormat(d3.format("d"));
		
	//Create Ball Speed SVG
	ballSpeed = d3.select(".chart.ballSpeed").append("svg")
		.attr("width", widthBallSpeed + marginBallSpeed.left + marginBallSpeed.right)
		.attr("height", heightBallSpeed + marginBallSpeed.top + marginBallSpeed.bottom)
	  .append("g")
		.attr("class", "ballSpeedWrapper")
		.attr("transform", "translate(" + marginBallSpeed.left + "," + marginBallSpeed.top + ")");
		
	//Append x axis to chart
	ballSpeed.append("g")
	  .attr("class", "x axis")
	  .attr("transform", "translate(0," + 0 + ")")
	  .call(ballSpeedAxis);

	//Append circle at starting point
	ballSpeed.append("circle")
			.attr("cx", 0)
			.attr("cy", 0)
			.attr("r", 10)
			.style("fill", "#81BC00");

	//Append pulsating circle for previous strike
	ballSpeed.append("circle")
			.attr("class", "pulseCircle")
			.attr("r", 0)
			.attr("cx", 0)
			.attr("cy", 0)
			.style("opacity", 0.4)
			.style("fill", "#81BC00")
			.each(function(d) { pulseCircle(ballSpeed); });		
			
	////////////////////////////////////////////////////////////// 
	////////////////////// Club Speed //////////////////////////// 
	////////////////////////////////////////////////////////////// 

	marginClubSpeed = {top: 30, right: 50, bottom: 30, left: 50};
	widthClubSpeed = $(".chart.clubSpeed").width() - marginClubSpeed.left - marginClubSpeed.right;
	heightClubSpeed = widthClubSpeed*0.5;
		
	//Create axes for the Club Speed chart
	clubSpeedScale = d3.scale.linear().domain([0, 125]).range([0, widthClubSpeed]);
	clubSpeedAxis = d3.svg.axis().scale(clubSpeedScale).orient("bottom").tickSize(20).outerTickSize(0).tickFormat(d3.format("d"));
		
	//Create Club Speed SVG
	clubSpeed = d3.select(".chart.clubSpeed").append("svg")
		.attr("width", widthClubSpeed + marginClubSpeed.left + marginClubSpeed.right)
		.attr("height", heightClubSpeed + marginClubSpeed.top + marginClubSpeed.bottom)
	  .append("g")
		.attr("class", "clubSpeedWrapper")
		.attr("transform", "translate(" + marginClubSpeed.left + "," + marginClubSpeed.top + ")");
		
	//Append x axis to chart
	clubSpeed.append("g")
	  .attr("class", "x axis")
	  .attr("transform", "translate(0," + 0 + ")")
	  .call(clubSpeedAxis);
	  
	var defs_1 = clubSpeed.append('defs');
	var filter_2 = defs_1.append('filter').attr('id','goo');
	var feGaussianBlur_3 = filter_2.append('feGaussianBlur')
		.attr('in','SourceGraphic')
		.attr('stdDeviation','10')
		.attr('result','blur');
	var feColorMatrix_4 = filter_2.append('feColorMatrix')
		.attr('in','blur')
		.attr('mode','matrix')
		.attr('values','1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7')
		.attr('result','goo');
	var feBlend_5 = filter_2.append('feBlend')
		.attr('in','SourceGraphic')
		.attr('in2','goo');
		
	clubSpeedCircles = clubSpeed.append("g").style("filter", "url(#goo)");

	//Append circle at starting point
	clubSpeedCircles.append("circle")
			.attr("class", "startCircle")
			.attr("cx", 0)
			.attr("cy", 0)
			.attr("r", 10)
			.style("fill", "#81BC00");	 
			
	//Append pulsating circle for previous strike
	clubSpeed.append("circle")
			.attr("class", "pulseCircle")
			.attr("r", 0)
			.attr("cx", 0)
			.attr("cy", 0)
			.style("fill", "#81BC00")
			.style("opacity", 0.4)
			.each(function(d) { pulseCircle(clubSpeed); });		
			
}//setupVisuals

//Create a small pulsating circle
function pulseCircle(wrapper) {
		var circle = wrapper.selectAll(".pulseCircle");
		(function repeat() {
			circle = circle.transition("pulse")
				.duration(2000)
				.attr("r", 15)
				//.style("opacity", 0.3)
				.transition()
				.duration(2000)
				.attr("r", 0)
				//.style("opacity", 1)
				.each("end", repeat);
		})();
}//pulseCircle

function redrawSwing(timeStamp) {

	//Take only those datapoints from data which happened after the start
	var subset = data.filter(function(d) { return d.id <= timeStamp; });
	//Convert the data to numeric
	subset.forEach(function(d,i) {
		d.AttackAngle = +d.AttackAngle;
		d.BallSpeed = +d.BallSpeed;
		d.Carry = +d.Carry;
		d.ClubSpeed = +d.ClubSpeed;
		d.Side = +d.Side;
	})
	
	////////////////////////////////////////////////////////////// 
	/////////////////////// Ball Speed /////////////////////////// 
	////////////////////////////////////////////////////////////// 	

	var ballSpeedDelay = 1000,
		ballSpeeDuration = 3000;
		
	ballSpeedScale.domain([0, d3.max(subset, function(d) { return d.BallSpeed; })*1.2]);
	ballSpeedAxis.scale(ballSpeedScale);
	//Update the x axis
	ballSpeed.select(".x.axis")
		.transition().duration(ballSpeeDuration).delay(ballSpeedDelay)
		.call(ballSpeedAxis);
	
  	//DATA JOIN
	//Join new data with old elements, if any
	var ballSpeedWrapper = ballSpeed.selectAll(".ballspeedCircle")
		.data(subset, function(d) { return d.id; });
	  
	//UPDATE
	ballSpeedWrapper
		.transition().duration(ballSpeeDuration).delay(ballSpeedDelay)
			.style("opacity", 0.5)
			.attr("r", 5)
			.attr("cx", function(d) { return ballSpeedScale(d.BallSpeed); });;	
	
	//ENTER 
	ballSpeedWrapper
		.enter().append("circle")
			.attr("class", "ballspeedCircle")
			.attr("cx", 0)
			.attr("cy", 0)
			.attr("r", 8)
			.style("fill", "#81BC00")
			.style("opacity", 0)
			.transition().duration(ballSpeeDuration).delay(ballSpeedDelay)
			.style("opacity", 1)
			.attr("cx", function(d) { return ballSpeedScale(d.BallSpeed); });

	//EXIT
	ballSpeedWrapper.exit().remove();	
	
	//Move the pulsating dot that shows the current swing to the most recent swing
	ballSpeed.selectAll(".pulseCircle")
			.transition("move").duration(1000).delay(ballSpeedDelay-1000)
			.style("opacity", 0)
			.transition("move").duration(ballSpeeDuration)
			.attr("cx", ballSpeedScale(subset[(numSwings-1)].BallSpeed))
			.transition("move").duration(2000)
			.style("opacity", 0.4); 

	////////////////////////////////////////////////////////////// 
	/////////////////////// Club Speed /////////////////////////// 
	////////////////////////////////////////////////////////////// 

	var clubSpeedDelay = 4000,
		clubSpeeDuration = 3000;

	clubSpeedScale.domain([0, d3.max(subset, function(d) { return d.ClubSpeed; })*1.2]);
	clubSpeedAxis.scale(clubSpeedScale);
	//Update the x axis
	clubSpeed.select(".x.axis")
		.transition().duration(clubSpeeDuration).delay(clubSpeedDelay)
		.call(clubSpeedAxis);
		
	//Increase size of circle at 0,0 (then the swing is "ejected" and then decrease size again
	clubSpeedCircles.select(".startCircle")
		.transition().duration(1000).delay((clubSpeedDelay-1000))
		.attr("r", 20)
		.transition().duration(clubSpeeDuration)
		.attr("r", 10);
	
  	//DATA JOIN
	//Join new data with old elements, if any
	var clubSpeedWrapper = clubSpeedCircles.selectAll(".clubspeedCircle")
		.data(subset, function(d) { return d.id; });
	  
	//UPDATE
	clubSpeedWrapper
		.transition().duration(clubSpeeDuration).delay(clubSpeedDelay)
			.style("opacity", 0.5)
			.attr("r", 5)
			.attr("cx", function(d) { return clubSpeedScale(d.ClubSpeed); });	
	
	//ENTER 
	clubSpeedWrapper
		.enter().append("circle")
			.attr("class", "clubspeedCircle")
			.attr("cx", 0)
			.attr("cy", 0)
			.attr("r", 0)
			.style("fill", "#81BC00")
			.transition().duration(1000).delay((clubSpeedDelay-1000))
			.attr("r", 20)
			.transition().duration(clubSpeeDuration)
			.attr("r", 8)
			.attr("cx", function(d) { return clubSpeedScale(d.ClubSpeed); });

	//EXIT
	clubSpeedWrapper.exit().remove();	
	
	//Move the pulsating dot that shows the current swing to the most recent swing
	clubSpeed.selectAll(".pulseCircle")
			.transition("move").duration(1000).delay(clubSpeedDelay-1000)
			.style("opacity", 0)
			.transition("move").duration(clubSpeeDuration)
			.attr("cx", clubSpeedScale(subset[(numSwings-1)].ClubSpeed))
			.transition("move").duration(2000)
			.style("opacity", 0.4); 
			
	
}//redrawSwing
				
    </script>
  </body>
</html>